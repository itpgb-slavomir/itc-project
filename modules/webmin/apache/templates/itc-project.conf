CustomLog                  /var/log/virtualmin/${DOM}_access_log combined
DirectoryIndex             index.xml index.html index.php
DocumentRoot               ${HOME}/
ErrorLog                   /var/log/virtualmin/${DOM}_error_log
ProxyRequests              Off
ProxyPreserveHost          On
ProxyVia                   Off
RewriteEngine              On
ServerName                 ${DOM}
ScriptAlias                /cgi-bin/ ${HOME}/cgi-bin/
SSLProxyEngine             On
SSLProxyVerify             none
SSLProxyCheckPeerCN        off
SSLProxyCheckPeerName      off
SSLProxyCheckPeerExpire    off
UseCanonicalName           Off
VirtualDocumentRoot        ${HOME}/%1

RequestHeader set X-Forwarded-Context /
<Proxy *>
	AddDefaultCharset off
	Order deny,allow
	Allow from all
</Proxy>

<Directory ${HOME}/>
	Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
	Allow From All
	AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

ServerAlias                web.${DOM}
ServerAlias                www.${DOM}

RewriteCond %{SERVER_PORT}                443
RewriteCond %{HTTP_HOST} =${DOM}         [NC]
RewriteRule ^(.*)$ https://www.${DOM}$1   [R]

RewriteCond %{SERVER_PORT}                80
RewriteCond %{HTTP_HOST} =${DOM}         [NC]
RewriteRule ^(.*)$ http://www.${DOM}$1    [R]


RewriteCond %{SERVER_PORT}               443
RewriteCond %{HTTP_HOST} =www.${DOM}    [NC]
RewriteRule ^(.*)$ https://web.${DOM}    [R]

RewriteCond %{SERVER_PORT}               80
RewriteCond %{HTTP_HOST} =www.${DOM}    [NC]
RewriteRule ^(.*)$ http://web.${DOM}     [R]

<Directory ${HOME}/web>
 Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
 Allow From All
 AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

<Directory ${HOME}/www>
 Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
 Allow From All
 AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

ServerAlias                dev.${DOM}
ServerAlias                www.dev.${DOM}
ServerAlias                test.${DOM}
ServerAlias                www.test.${DOM}
ServerAlias                stage.${DOM}
ServerAlias                www.stage.${DOM}
ServerAlias                prod.${DOM}
ServerAlias                www.prod.${DOM}

ServerAlias                smtp.${DOM}
ServerAlias                imap.${DOM}
ServerAlias                email.${DOM}

ServerAlias                ldap.${DOM}

ServerAlias                maven.${DOM}
ServerAlias                snapshots.maven.${DOM}
ServerAlias                *.snapshots.maven.${DOM}
ServerAlias                releases.maven.${DOM}
ServerAlias                *.releases.${DOM}

ServerAlias                nexus.${DOM}
ServerAlias                snapshots.nexus.${DOM}
ServerAlias                releases.nexus.${DOM}
ServerAlias                repository.${DOM}
ServerAlias                snapshots.repository.${DOM}
ServerAlias                releases.repository.${DOM}
ServerAlias                snapshots.nexus.${DOM}

ServerAlias                jenkins.${DOM}
ServerAlias                git.${DOM}

ServerAlias                tests.${DOM}
ServerAlias                sonar.${DOM}

ServerAlias                apache.${DOM}
ServerAlias                tomcat.${DOM}
ServerAlias                nginx.${DOM}
ServerAlias                awstats.${DOM}
ServerAlias                logs.${DOM}
ServerAlias                ovirt.${DOM}
ServerAlias                openstack.${DOM}
ServerAlias                mysql.${DOM}

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =mysql.${DOM} [NC]
RewriteRule ^(.*)$ https://mysql.${DOM}/phpMyAdmin$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =mysql.${DOM} [NC]
RewriteRule ^(.*)$ http://mysql.${DOM}/phpMyAdmin$1 [P,L]

ServerAlias                pgsql.${DOM}

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =pgsql.${DOM} [NC]
RewriteRule ^(.*)$ https://pgsql.${DOM}/phpPgAdmin$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =pgsql.${DOM} [NC]
RewriteRule ^(.*)$ http://pgsql.${DOM}/phpPgAdmin$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =jenkins.${DOM} [NC]
RewriteRule ^(.*)$ https://jenkins.${DOM}:8143$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =jenkins.${DOM} [NC]
RewriteRule ^(.*)$ http://jenkins.${DOM}:8180$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =nexus.${DOM} [NC]
RewriteRule ^(.*)$ http://nexus.${DOM}:8081$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =nexus.${DOM} [NC]
RewriteRule ^(.*)$ http://nexus.${DOM}:8081$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =redmine.${DOM} [NC]
RewriteRule ^(.*)$ http://redmine.${DOM}:3000$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =redmine.${DOM} [NC]
RewriteRule ^(.*)$ http://redmine.${DOM}:3000$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =sonar.${DOM} [NC]
RewriteRule ^(.*)$ http://sonar.${DOM}:9443$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =sonar.${DOM} [NC]
RewriteRule ^(.*)$ http://sonar.${DOM}:9000$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =ntop.${DOM} [NC]
RewriteRule ^(.*)$ http://ntop.${DOM}:3443$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =ntop.${DOM} [NC]
RewriteRule ^(.*)$ http://ntop.${DOM}:3000$1 [P,L]

RewriteCond %{HTTP_HOST} =nexus.${DOM} [NC]
RewriteRule ^(.*)$ http://nexus.${DOM}:8081$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =tomcat.${DOM} [NC]
RewriteRule ^(.*)$ http://tomcat.${DOM}:8443$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =tomcat.${DOM} [NC]
RewriteRule ^(.*)$ http://tomcat.${DOM}:8080$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =git.${DOM} [NC]
RewriteRule ^(.*)$ http://tomcat.${DOM}:8443/gitblit-1.6.3-SNAPSHOT$1 [P,L]

#ProxyPass /gitblit-1.6.3-SNAPSHOT http://tomcat.${DOM}:8080/gitblit-1.6.3-SNAPSHOT
#ProxyPassreverse /gitblit-1.6.3-SNAPSHOT http://tomcat.${DOM}:8080/gitblit-1.6.3-SNAPSHOT

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =git.${DOM} [NC]
RewriteRule ^(.*)$ http://tomcat.${DOM}:8080/gitblit-1.6.3-SNAPSHOT$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =email.${DOM} [NC]
RewriteRule ^(.*)$ https://email.${DOM}/email$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =email.${DOM} [NC]
RewriteRule ^(.*)$ http://email.${DOM}/email$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =ovirt.${DOM} [NC]
RewriteRule ^(.*)$ https://${DOM}/ovirt-engine$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =ovirt.${DOM} [NC]
RewriteRule ^(.*)$ http://${DOM}/ovirt-engine$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =ldap.${DOM} [NC]
RewriteRule ^(.*)$ https://ldap.${DOM}/ldap$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =ldap.${DOM} [NC]
RewriteRule ^(.*)$ http://ldap.${DOM}/ldap$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =nginx.${DOM} [NC]
RewriteRule ^(.*)$ https://nginx.${DOM}:8480$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =nginx.${DOM} [NC]
RewriteRule ^(.*)$ http://nginx.${DOM}:8480$1 [P,L]

RewriteCond %{HTTP_HOST} =maven.${DOM} [NC]
RewriteRule ^(.*)$ http://www.${DOM}/maven [P,L]

Alias /phpMyAdmin /var/www/sk.itcloud/sk.itcloud.mysql
Alias /phpmyadmin /var/www/sk.itcloud/sk.itcloud.mysql

<Directory /var/www/sk.itcloud.itc/phpMyAdmin/>
	Options Indexes FollowSymLinks MultiViews
	AllowOverride all
	Order Allow,Deny 
	Allow from all
</Directory>

<Directory /var/www/sk.itcloud.itc/phpMyAdmin/setup/>
	Order Allow,Deny
	Allow from all
</Directory>

# These directories do not require access over HTTP - taken from the original
# phpMyAdmin upstream tarball
#
<Directory /var/www/sk.itcloud/sk.itcloud.mysql/libraries/>
    Order Deny,Allow
    Deny from All
    Allow from None
</Directory>

<Directory /var/www/sk.itcloud/sk.itcloud.mysql/setup/lib/>
    Order Allow,Deny
    Allow from All
</Directory>

<Directory /var/www/sk.itcloud/sk.itcloud.mysql/setup/frames/>
    Order Allow,Deny
    Allow from All
</Directory>

Alias /maven /usr/share/maven-sites/${GROUP}/${USER}/${DOM}
<Directory "/usr/share/maven-sites/${GROUP}/${USER}/${DOM}">
	Options Indexes MultiViews FollowSymlinks
	AllowOverride None
	Require all granted
</Directory>

<Directory ${HOME}/cgi-bin>
	allow from all
	AllowOverride All  Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>