CustomLog                  /var/log/virtualmin/${DOM}_access_log combined
DirectoryIndex             index.xml index.html index.php
DocumentRoot               ${HOME}/
ErrorLog                   /var/log/virtualmin/${DOM}_error_log
ProxyRequests              On
ProxyPreserveHost          On
ProxyVia                   On
RewriteEngine              On
ServerName                 ${DOM}
ScriptAlias                /cgi-bin/ ${HOME}/cgi-bin/
SSLProxyEngine             On
SSLProxyVerify             none
SSLProxyCheckPeerCN        off
SSLProxyCheckPeerName      off
SSLProxyCheckPeerExpire    off
UseCanonicalName           Off
VirtualDocumentRoot        ${HOME}/%1

<Directory ${HOME}/>
	Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
	Allow From All
	AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

ServerAlias                www.${DOM}

RewriteCond %{SERVER_PORT}               443
RewriteCond %{HTTP_HOST} =${DOM}         [NC]
RewriteRule ^(.*)$ https://www.${DOM}    [R]

RewriteCond %{SERVER_PORT}               80
RewriteCond %{HTTP_HOST} =${DOM}         [NC]
RewriteRule ^(.*)$ http://www.${DOM}     [R]

<Directory ${HOME}/web>
	Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
	Allow From All
	AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

<Directory ${HOME}/www>
	Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
	Allow From All
	AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

ServerAlias                ${DOM}.dev
ServerAlias                www.${DOM}.dev
ServerAlias                ${DOM}.test
ServerAlias                www.${DOM}.test
ServerAlias                ${DOM}.stage
ServerAlias                www.${DOM}.stage
ServerAlias                ${DOM}.prod
ServerAlias                www.${DOM}.prod

ServerAlias                smtp.${DOM}
ServerAlias                imap.${DOM}
ServerAlias                email.${DOM}

ServerAlias                ldap.${DOM}

ServerAlias                maven.${DOM}
ServerAlias                snapshots.maven.${DOM}
ServerAlias                *.snapshots.maven.${DOM}
ServerAlias                releases.maven.${DOM}
ServerAlias                *.releases.${DOM}

ServerAlias                nexus.${DOM}
ServerAlias                snapshots.nexus.${DOM}
ServerAlias                releases.nexus.${DOM}
ServerAlias                repository.${DOM}
ServerAlias                snapshots.repository.${DOM}
ServerAlias                releases.repository.${DOM}
ServerAlias                snapshots.nexus.${DOM}

ServerAlias                jenkins.${DOM}
ServerAlias                git.${DOM}

ServerAlias                tests.${DOM}
ServerAlias                sonar.${DOM}

ServerAlias                apache.${DOM}
ServerAlias                tomcat.${DOM}
ServerAlias                nginx.${DOM}
ServerAlias                awstats.${DOM}
ServerAlias                logs.${DOM}
ServerAlias                mysql.${DOM}
ServerAlias                pgsql.${DOM}

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =jenkins.${DOM} [NC]
RewriteRule ^(.*)$ https://jenkins.${DOM}:8143$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =jenkins.${DOM} [NC]
RewriteRule ^(.*)$ http://jenkins.${DOM}:8180$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =nexus.${DOM} [NC]
RewriteRule ^(.*)$ http://nexus.${DOM}:8081$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =nexus.${DOM} [NC]
RewriteRule ^(.*)$ http://nexus.${DOM}:8081$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =redmine.${DOM} [NC]
RewriteRule ^(.*)$ http://redmine.${DOM}:3000$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =redmine.${DOM} [NC]
RewriteRule ^(.*)$ http://redmine.${DOM}:3000$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =sonar.${DOM} [NC]
RewriteRule ^(.*)$ http://sonar.${DOM}:9443$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =sonar.${DOM} [NC]
RewriteRule ^(.*)$ http://sonar.${DOM}:9000$1 [P,L]

RewriteCond %{HTTP_HOST} =nexus.${DOM} [NC]
RewriteRule ^(.*)$ http://nexus.${DOM}:8081$1 [P,L]

RewriteCond %{HTTP_HOST} =git.${DOM} [NC]
RewriteRule ^(.*)$ http://tomcat.${DOM}/gitblit-1.6.2$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =tomcat.${DOM} [NC]
RewriteRule ^(.*)$ http://tomcat.${DOM}:8443$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =tomcat.${DOM} [NC]
RewriteRule ^(.*)$ http://tomcat.${DOM}:8080$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =mysql.${DOM} [NC]
RewriteRule ^(.*)$ https://mysql.${DOM}/phpmyadmin$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =mysql.${DOM} [NC]
RewriteRule ^(.*)$ http://mysql.${DOM}/phpmyadmin$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =pgsql.${DOM} [NC]
RewriteRule ^(.*)$ https://pgsql.${DOM}/phppgadmin$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =pgsql.${DOM} [NC]
RewriteRule ^(.*)$ http://pgsql.${DOM}/phppgadmin$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =ldap.${DOM} [NC]
RewriteRule ^(.*)$ https://ldap.${DOM}/ldap$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =ldap.${DOM} [NC]
RewriteRule ^(.*)$ http://ldap.${DOM}/ldap$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =nginx.${DOM} [NC]
RewriteRule ^(.*)$ https://nginx.${DOM}:8480$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =nginx.${DOM} [NC]
RewriteRule ^(.*)$ http://nginx.${DOM}:8480$1 [P,L]

RewriteCond %{HTTP_HOST} =maven.${DOM} [NC]
RewriteRule ^(.*)$ http://www.${DOM}/maven [P,L]

RewriteCond %{HTTP_HOST} =project.${DOM} [NC]
RewriteRule ^(.*)$ http://www.${DOM}/project [P,L]

RewriteCond %{HTTP_HOST} =portal.${DOM} [NC]
RewriteRule ^(.*)$ http://portal.${DOM}:8680$1 [P,L]

RewriteCond %{HTTP_HOST} =repository.${DOM} [NC]
RewriteRule ^(.*)$ http://repository.${DOM}:8080/chemistry-opencmis-server-fileshare-0.12.0$1 [P,L]

RewriteCond %{HTTP_HOST} =visual-php-admin.itc.${DOM}
RewriteRule ^(.*)$ http://www.${DOM}/visual-php-admin [P,L]

Alias /maven /usr/share/maven-sites
<Directory "/usr/share/maven-sites">
	Options Indexes MultiViews FollowSymlinks
	AllowOverride None
	Require all granted
</Directory>

Alias /project /usr/share/sk.itcloud.web/www
<Directory "/usr/share/sk.itcloud.web/www">
	Options Indexes MultiViews FollowSymlinks
	AllowOverride None
	Require all granted
</Directory>

<Directory ${HOME}/cgi-bin>
	allow from all
	AllowOverride All  Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>