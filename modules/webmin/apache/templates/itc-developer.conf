CustomLog                  /var/log/virtualmin/${DOM}_access_log combined
DirectoryIndex             index.xml index.html index.php
DocumentRoot               ${HOME}/
ErrorLog                   /var/log/virtualmin/${DOM}_error_log
ProxyRequests              On
ProxyPreserveHost          On
ProxyVia                   On
RewriteEngine              On
ServerName                 ${DOM}
ScriptAlias                /cgi-bin/ ${HOME}/cgi-bin/
SSLProxyEngine             On
SSLProxyVerify             none
SSLProxyCheckPeerCN        off
SSLProxyCheckPeerName      off
SSLProxyCheckPeerExpire    off
UseCanonicalName           Off
VirtualDocumentRoot        ${HOME}/%1
IndexStyleSheet            "/css/style.css"

<Directory ${HOME}/>
	Options +Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
	Allow From All
	AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

ServerAlias                www.${DOM}

RewriteCond %{SERVER_PORT}               443
RewriteCond %{HTTP_HOST} =${DOM}         [NC]
RewriteRule ^(.*)$ https://www.${DOM}    [R]

RewriteCond %{SERVER_PORT}               80
RewriteCond %{HTTP_HOST} =${DOM}         [NC]
RewriteRule ^(.*)$ http://www.${DOM}     [R]

<Directory ${HOME}/Environment>
	Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
	Allow From All
	AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

<Directory ${HOME}/www>
	Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
	Allow From All
	AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

ServerAlias                smtp.${DOM}
ServerAlias                imap.${DOM}
ServerAlias                email.${DOM}
ServerAlias                nexus.${DOM}
ServerAlias                jenkins.${DOM}
ServerAlias                git.${DOM}
ServerAlias                sonar.${DOM}
ServerAlias                awstats.${DOM}
ServerAlias                logs.${DOM}
ServerAlias                mysql.${DOM}

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =mysql.${DOM} [NC]
RewriteRule ^(.*)$ https://mysql.${DOM}/mysql$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =mysql.${DOM} [NC]
RewriteRule ^(.*)$ http://mysql.${DOM}/mysql$1 [P,L]

Alias /mysql /usr/share/phpMyAdmin
<Directory ${HOME}/mysql>
	Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
	Allow From All
	AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

ServerAlias                pgsql.${DOM}

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =pgsql.${DOM} [NC]
RewriteRule ^(.*)$ https://pgsql.${DOM}/pgsql$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =pgsql.${DOM} [NC]
RewriteRule ^(.*)$ http://pgsql.${DOM}/pgsql$1 [P,L]

Alias /pgsql //usr/share/phpPgAdmin
<Directory ${HOME}/pgsql>
	Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
	Allow From All
	AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =jenkins.${DOM} [NC]
RewriteRule ^(.*)$ https://jenkins.${DOM}:8143$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =jenkins.${DOM} [NC]
RewriteRule ^(.*)$ http://jenkins.${DOM}:8180$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =nexus.${DOM} [NC]
RewriteRule ^(.*)$ http://nexus.${DOM}:8081$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =nexus.${DOM} [NC]
RewriteRule ^(.*)$ http://nexus.${DOM}:8081$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =redmine.${DOM} [NC]
RewriteRule ^(.*)$ http://redmine.${DOM}:3000$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =redmine.${DOM} [NC]
RewriteRule ^(.*)$ http://redmine.${DOM}:3000$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =sonar.${DOM} [NC]
RewriteRule ^(.*)$ http://sonar.${DOM}:9443$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =sonar.${DOM} [NC]
RewriteRule ^(.*)$ http://sonar.${DOM}:9000$1 [P,L]

RewriteCond %{HTTP_HOST} =nexus.${DOM} [NC]
RewriteRule ^(.*)$ http://nexus.${DOM}:8081$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =email.${DOM} [NC]
RewriteRule ^(.*)$ https://email.${DOM}/email$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =pgsql.${DOM} [NC]
RewriteRule ^(.*)$ http://pgsql.${DOM}/phppgadmin$1 [P,L]

<Directory ${HOME}/cgi-bin>
	allow from all
	AllowOverride All  Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>