ProxyRequests              On
ProxyPreserveHost          On
ProxyVia                   On
RewriteEngine              On
ServerName                 ${DOM}
SSLProxyEngine             On
SSLProxyVerify             none
SSLProxyCheckPeerCN        off
SSLProxyCheckPeerName      off
SSLProxyCheckPeerExpire    off
VirtualDocumentRoot        ${HOME}/%1

ServerAlias *.${DOM}

ErrorLog /var/log/virtualmin/${DOM}_error_log
CustomLog /var/log/virtualmin/${DOM}_access_log combined
DirectoryIndex index.html index.htm index.php index.php4 index.php5
DocumentRoot ${HOME}

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =nexus.${DOM} [NC]
RewriteRule ^(.*)$ https://nexus.${DOM}:8081$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =nexus.${DOM} [NC]
RewriteRule ^(.*)$ http://nexus.${DOM}:8081$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =jenkins.${DOM} [NC]
RewriteRule ^(.*)$ http://jenkins.${DOM}:8143$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =jenkins.${DOM} [NC]
RewriteRule ^(.*)$ http://jenkins.${DOM}:8180$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =sonar.${DOM} [NC]
RewriteRule ^(.*)$ http://sonar.${DOM}:9000$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =sonar.${DOM} [NC]
RewriteRule ^(.*)$ http://sonar.${DOM}:9000$1 [P,L]

ProxyPassReverse "/git" "http://git.${DOM}"
RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =git.${DOM} [NC]
RewriteRule ^(.*)$ http://127.0.0.1/git$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =git.${DOM} [NC]
RewriteRule ^(.*)$  http://127.0.0.1/git$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =ldap.${DOM} [NC]
RewriteRule ^(.*)$ https://127.0.0.1/phpldapadmin$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =ldap.${DOM} [NC]
RewriteRule ^(.*)$ http://127.0.0.1/phpldapadmin$1 [P,L]


RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =memcache.${DOM} [NC]
RewriteRule ^(.*)$ https://127.0.0.1/phpmemcachedadmin$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =memcache.${DOM} [NC]
RewriteRule ^(.*)$ http://127.0.0.1/phpmemcachedadmin$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =mysql.${DOM} [NC]
RewriteRule ^(.*)$ https://127.0.0.1/phpMyAdmin$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =mysql.${DOM} [NC]
RewriteRule ^(.*)$ http://127.0.0.1/phpMyAdmin$1 [P,L]


RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =adminer.${DOM} [NC]
RewriteRule ^(.*)$ https://127.0.0.1/adminer$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =mysql.${DOM} [NC]
RewriteRule ^(.*)$ http://127.0.0.1/adminer$1 [P,L]


RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =adminer.${DOM} [NC]
RewriteRule ^(.*)$ https://127.0.0.1/adminer$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =adminer.${DOM} [NC]
RewriteRule ^(.*)$ http://127.0.0.1/adminer$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =maven.${DOM} [NC]
RewriteRule ^(.*)$ https://${DOM}/maven$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =maven.${DOM} [NC]
RewriteRule ^(.*)$ http://${DOM}/maven$1 [P,L]

RewriteCond %{SERVER_PORT} 443
RewriteCond %{HTTP_HOST} =doc.${DOM} [NC]
RewriteRule ^(.*)$ https://${DOM}/doc$1 [P,L]

RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} =doc.${DOM} [NC]
RewriteRule ^(.*)$ http://${DOM}/doc$1 [P,L]

Alias /doc ${HOME}/doc
<Directory ${HOME}/doc>
 Options Indexes FollowSymLinks MultiViews
 AllowOverride all
 Order Allow,Deny 
 Allow from all
</Directory>

<Directory ${HOME}/www>
 Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
 allow from all
 AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

<Directory ${HOME}/html>
 Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
 allow from all
 AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

Alias /maven ${HOME}/target/site
<Directory ${HOME}/target/site>
 Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch
 allow from all
 AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

ScriptAlias /cgi-bin/ ${HOME}/cgi-bin/
<Directory ${HOME}/cgi-bin>
 allow from all
 AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

ScriptAlias /agi-bin/ ${HOME}/agi-bin/
<Directory ${HOME}/agi-bin>
 allow from all
 AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
</Directory>

Alias /doc ${HOME}/doc
<Directory ${HOME}/doc>
 Options Indexes FollowSymLinks MultiViews
 AllowOverride all
 Order Allow,Deny 
 Allow from all
</Directory>

Alias /git /var/www/git
<Directory /var/www/git>
  Options +ExecCGI
  AddHandler cgi-script .cgi
  DirectoryIndex gitweb.cgi
</Directory>